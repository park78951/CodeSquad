# Javadcript 작동 원리 (학습내용 출처:[poiemaweb](https://poiemaweb.com/js-execution-context))


Execution Context(실행 컨텍스트)는 javascript를 공부하며 이해하기 힘들었던 scope, hoisting, this, closure, function 등의 작동 원리를 내포하고 있는 중요 원리라고 한다.<br>
실행 컨텍스트를 익힘으로써 코드 독해와 디버깅이 한층 쉬워질 것이라고 한다.

## Execution Context(실행 컨텍스트)?

실행 컨텍스트는 실행 가능한 코드가 실행되기 위한 실행 환경이라고 정의하였다.<br>
실행 가능한 코드란 아래와 같다.
1. 전역 코드 (전역 영역에 존재)
2. Eval 코드: eval 함수로 실행되는 코드 (거의 사용하지 않음)
3. 함수 코드: 함수 내에 존재하는 코드

코드 실행을 위해서는 아래와 같은 정보를 알아야 한다.
- 변수: 전역변수, 지역변수, 매개변수, 객체의 property
- 함수 선언
- 변수의 유효범위(scope)
- this

이러한 실행 필요 정보를 형상화 하기 위해 자바스크립트 엔진은 실행 컨텍스트를 물리적 ***객체***의 형태로 관리한다.

## 실행 컨텍스트의 stack 구조
코드를 실행하면 현재 실행 컨텍스트 스택이 생기고 사라진다. 만약 코드를 읽는 도중 현재 컨텍스트 외의 코드가 실행된다면, 새로운 컨텍스트가 생성되고 스택이 위로 쌓이게 된다. <br>
예를 들어,
1. 컨트롤이 실행 가능한 코드로 이동.
2. 새로운 실행 컨텍스트 스택 생성. 가장 마지막에 쌓인 스택이 가장 먼저 빠져나오는 구조.
3. 컨트롤이 전역 코드로 이동 후 전역 컨텍스트 생성.
4. 전역 컨텍스트가 스택에 쌓임.(어플리케이션이 종료될 때 까지 유지)
5. 함수 호출시 해당 함수의 실행 컨텍스트 생성. 직전 실행된 코드 블록의 실행 컨텍스트 위에 쌓임
6. 함수 실행이 끝나면 해당 함수의 실행 컨텍스트 파기. 직전 실행 코드로 컨트롤 반환.

## 실행 컨텍스트 객체와 3가지 프로퍼티
실행 컨텍스트는 추상적인 개념이지만 물리적으로 객체의 형태를 가지며 아래와 같은 3가지 프로퍼티를 소유한다.
1. variable object
2. scope chain
3. thisValue

### Variable Object (VO / 변수객체)

실행 컨텍스트가 생성되면 여러가지 정보를 담을 객체를 생성하는데, 이것이 바로 variable object라고 한다. VO는 코드 실행시 엔진에 의해 참조되고 코드에서 접근할 수 없다.

VO에 담긴 정보는
- 변수
- parameter / arguments
- 함수 선언 (표현식은 변수에 해당)

전역 컨텍스트의 경우와 함수 컨텍스트의 경우 서로 가리키는 VO가 다르다고 한다. 전역에는 매개변수가 없고 함수에는 매개변수가 있는 차이가 바로 그 이유이다. <br><br>
전역 컨텍스트의 VO특징은
1. 유일하며 최상위에 위치.
2. 모든 전역변수, 전역 함수 등을 프로퍼티로 소유하는 전역 객체(Global Object)를 가리킴.

함수 컨텍스트의 VO특징은
1. 활성객체를 가리킴
2. 매개변수와 인수들의 정보를 배열의 형태로 담고 있는 객체인 argument object 추가. (전역변수, 전역함수, argument object)

### Scope Chain
스코프 체인은 전역 또는 함수가 참조 할 수 있는 변수, 함수 선언 등의 정보를 담고 있는 전역 객체 또는 활성 객체의 리스트를 가리킨다.<br>
식별자 중에서 객체의 프로퍼티가 아닌 변수를 검색하는 메커니즘이다.
<br>
<br>
엔진은 스코프체인을 통해 렉시컬 스코프를 먼저 파악하고, 상위 함수들의 스코프와 전역 스코프를 참조할 수 있다. 스택이 쌓일 수록 부모 함수의 scope가 자식 함수의 scope 체인에 포함된다. 그리고 실행중 변수를 만나면 현재 scope에서 하나씩 상위로 검색해 나가며 최종 전역 스코프까지 검색을 이어 나간다.<br>

### this
this property에는 this 값이 할당되고 this에 할당되는 값은 호출 패턴에 의해 결정된다고 한다. 함수의 경우 계속 전역 객체로 결정.


